<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividades SP PLC ONS - Controle e Gestão</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- SheetJS (Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Estilos Globais -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow: hidden; }
        
        /* Scrollbar Personalizada */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Animações */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Sidebar Transition */
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Inputs de Tabela */
        .cell-input { width: 100%; background: transparent; border: 1px solid transparent; padding: 4px 6px; border-radius: 4px; font-size: inherit; color: #334155; transition: all 0.2s; }
        .cell-input:focus { background: #fff; border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }
        .cell-input:hover { background: #f8fafc; border-color: #e2e8f0; }

        /* Colunas Redimensionáveis */
        .resizable-th { position: relative; }
        .resizer {
            position: absolute; right: 0; top: 0; bottom: 0; width: 15px; /* Área de toque maior para mobile */
            cursor: col-resize; user-select: none; touch-action: none;
            background-color: transparent; z-index: 20; display: flex; justify-content: center;
        }
        .resizer::after { content: ''; width: 1px; height: 100%; background: #e2e8f0; }
        .resizer:hover::after, .resizing::after { background-color: #3b82f6; width: 2px; }
        
        /* Filtro Tabs */
        .filter-tab { padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: 0.375rem;  white-space: nowrap; }
        .filter-tab.active { background-color: #2563eb; color: white; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .filter-tab.inactive { color: #64748b; background-color: transparent; }
        .filter-tab.inactive:hover { background-color: #f1f5f9; color: #334155; }

        /* Gráfico Donut */
        .pie-chart { width: 100px; height: 100px; border-radius: 50%; position: relative; margin: 0 auto; }
        .pie-center { position: absolute; inset: 0; margin: auto; width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #334155; font-size: 0.8rem; flex-direction: column; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- 1. BIBLIOTECA DE ÍCONES ---
        const Icon = ({ path, className, onClick }) => (
            <svg onClick={onClick} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={ { cursor: onClick ? 'pointer' : 'inherit' } }>
                {path}
            </svg>
        );

        const Icons = {
            Menu: (p) => <Icon {...p} path={<><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></>} />,
            Layout: (p) => <Icon {...p} path={<><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></>} />,
            Table: (p) => <Icon {...p} path={<><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/></>} />,
            BarChart: (p) => <Icon {...p} path={<><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></>} />,
            Columns: (p) => <Icon {...p} path={<><path d="M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7m0-18H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7m0-18v18"/></>} />,
            Grid: (p) => <Icon {...p} path={<><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></>} />,
            ThumbsUp: (p) => <Icon {...p} path={<><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></>} />,
            Trash2: (p) => <Icon {...p} path={<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>} />,
            Plus: (p) => <Icon {...p} path={<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>} />,
            Upload: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>} />,
            Download: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>} />,
            Calendar: (p) => <Icon {...p} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>} />,
            ChevronLeft: (p) => <Icon {...p} path={<><polyline points="15 18 9 12 15 6"/></>} />,
            ChevronRight: (p) => <Icon {...p} path={<><polyline points="9 18 15 12 9 6"/></>} />,
            CheckCircle: (p) => <Icon {...p} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            AlertCircle: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>} />,
            Filter: (p) => <Icon {...p} path={<><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></>} />,
            Search: (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>} />,
            Users: (p) => <Icon {...p} path={<><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>} />,
            ZoomIn: (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></>} />,
            ZoomOut: (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></>} />,
            WrapText: (p) => <Icon {...p} path={<><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="12" y2="18"/><path d="M18 12l2 2 2-2"/></>} />,
            Close: (p) => <Icon {...p} path={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />
        };

        // --- 2. UTILITÁRIOS ---
        const Utils = {
            parseDate: (d) => {
                if (!d) return null;
                if (d instanceof Date) return new Date(d.setHours(0,0,0,0));
                if (typeof d === 'number') return new Date((d - (25567 + 2)) * 86400 * 1000);
                if (typeof d === 'string') {
                    const t = d.trim();
                    let m = t.match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/);
                    if (m) return new Date(parseInt(m[1]), parseInt(m[2])-1, parseInt(m[3]));
                    m = t.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{4})$/);
                    if (m) return new Date(parseInt(m[3]), parseInt(m[2])-1, parseInt(m[1]));
                }
                return null;
            },
            formatDate: (d) => d instanceof Date && !isNaN(d) ? d.toLocaleDateString("pt-BR") : "",
            getTodayString: () => new Date().toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }),
            daysInMonth: (month, year) => new Date(year, month + 1, 0).getDate(),
            calculateWorkdays: (dueDate) => {
                if (!dueDate || isNaN(dueDate.getTime())) return 0;
                let today = new Date(); today.setHours(0,0,0,0); dueDate.setHours(0,0,0,0);
                if (dueDate.getTime() === today.getTime()) return 0;
                let count = 0, current = new Date(today);
                const isFuture = dueDate > today;
                if (isFuture) {
                    current.setDate(current.getDate() + 1);
                    while (current <= dueDate) {
                        const day = current.getDay();
                        if (day !== 0 && day !== 6) count++;
                        current.setDate(current.getDate() + 1);
                    }
                    return count; 
                } else {
                    while (current > dueDate) {
                        current.setDate(current.getDate() - 1);
                        const day = current.getDay();
                        if (day !== 0 && day !== 6) count--;
                    }
                    return count; 
                }
            }
        };

        // --- 3. COMPONENTES DE UI ---
        const ResizableHeader = ({ children, width, minWidth = 50, onResize }) => {
            const [isResizing, setIsResizing] = useState(false);
            const handleMouseDown = (e) => {
                e.preventDefault(); e.stopPropagation();
                setIsResizing(true);
                const startX = e.pageX; const startWidth = width;
                const handleMouseMove = (moveEvent) => {
                    if (moveEvent.touches) moveEvent = moveEvent.touches[0]; // Touch support
                    const newWidth = Math.max(minWidth, startWidth + (moveEvent.pageX - startX));
                    onResize(newWidth); 
                };
                const handleMouseUp = () => {
                    setIsResizing(false);
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    document.removeEventListener('touchmove', handleMouseMove);
                    document.removeEventListener('touchend', handleMouseUp);
                };
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                document.addEventListener('touchmove', handleMouseMove);
                document.addEventListener('touchend', handleMouseUp);
            };
            return (
                <th className={`p-3 border-b text-left relative bg-slate-100 font-bold text-slate-700 select-none ${isResizing ? 'bg-blue-50' : ''}`} style={ { width: width, minWidth: width } }>
                    <div className="flex items-center justify-between h-full">
                        <span className="truncate w-full block">{children}</span>
                        <div className={`resizer ${isResizing ? 'resizing' : ''}`} onMouseDown={handleMouseDown} onTouchStart={handleMouseDown}></div>
                    </div>
                </th>
            );
        };

        // --- 4. VIEWS ---

        const DashboardView = ({ detailedActivities }) => {
            const total = detailedActivities.length;
            const done = detailedActivities.filter(t => (t.status||'').toLowerCase().includes('conclu')).length;
            const pending = total - done;
            const efficiency = total > 0 ? Math.round((done/total)*100) : 0;
            const comRessalva = detailedActivities.filter(t => t.obs && t.obs.trim().length > 0).length;
            const uniqueResponsibles = [...new Set(detailedActivities.map(a => a.responsavel).filter(Boolean))];
            const respStats = uniqueResponsibles.map(r => {
                const tasks = detailedActivities.filter(a => a.responsavel === r);
                const rDone = tasks.filter(t => (t.status||'').toLowerCase().includes('conclu')).length;
                const rPending = tasks.length - rDone;
                return { name: r, done: rDone, pending: rPending, total: tasks.length };
            }).sort((a,b) => b.total - a.total);

            return (
                <div className="space-y-6 fade-in pb-10">
                    <h2 className="text-xl font-bold text-slate-800">Dashboard: Atividades SP MUST</h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between"><div><p className="text-xs font-bold text-slate-400 uppercase tracking-wide">Total</p><p className="text-2xl font-bold text-slate-800 mt-1">{total}</p></div><div className="bg-blue-50 p-2 rounded-lg text-blue-600"><Icons.Layout/></div></div>
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between"><div><p className="text-xs font-bold text-slate-400 uppercase tracking-wide">Resp.</p><p className="text-2xl font-bold text-indigo-600 mt-1">{uniqueResponsibles.length}</p></div><div className="bg-indigo-50 p-2 rounded-lg text-indigo-600"><Icons.Users/></div></div>
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between"><div><p className="text-xs font-bold text-slate-400 uppercase tracking-wide">Ressalvas</p><p className="text-2xl font-bold text-red-500 mt-1">{comRessalva}</p></div><div className="bg-red-50 p-2 rounded-lg text-red-500"><Icons.AlertCircle/></div></div>
                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between"><div><p className="text-xs font-bold text-slate-400 uppercase tracking-wide">Eficiência</p><p className="text-2xl font-bold text-emerald-600 mt-1">{efficiency}%</p></div><div className="bg-emerald-50 p-2 rounded-lg text-emerald-600"><Icons.BarChart/></div></div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col items-center"><h3 className="text-sm font-bold text-slate-600 uppercase mb-6 w-full border-b pb-2">Status</h3><div className="pie-chart" style={ { background: `conic-gradient(#10b981 0% ${(done/total)*100}%, #f59e0b ${(done/total)*100}% 100%)` } }><div className="pie-center"><span>{efficiency}%</span></div></div><div className="flex gap-4 mt-6 text-xs font-medium"><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-emerald-500"></div> Concl.</span><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-amber-500"></div> Pend.</span></div></div>
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col items-center"><h3 className="text-sm font-bold text-slate-600 uppercase mb-6 w-full border-b pb-2">Ressalvas</h3><div className="pie-chart" style={ { background: `conic-gradient(#ef4444 0% ${(comRessalva/total)*100}%, #e2e8f0 ${(comRessalva/total)*100}% 100%)` } }><div className="pie-center"><span className="text-red-500">{comRessalva}</span></div></div><div className="flex gap-4 mt-6 text-xs font-medium"><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-red-500"></div> Sim</span><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-slate-200"></div> Não</span></div></div>
                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col overflow-hidden"><h3 className="text-sm font-bold text-slate-600 uppercase mb-4 w-full border-b pb-2">Por Responsável</h3><div className="flex-grow overflow-y-auto custom-scrollbar pr-2" style={ { maxHeight: '200px' } }>{respStats.map((r, i) => (<div key={i} className="mb-2"><div className="flex justify-between text-xs mb-1"><span className="truncate w-20 font-medium">{r.name}</span><span className="text-slate-400">{r.total}</span></div><div className="w-full h-2 bg-slate-100 rounded-full flex overflow-hidden">{r.done>0&&<div className="bg-emerald-500 h-full" style={ { width: `${(r.done/r.total)*100}%` } }></div>}{r.pending>0&&<div className="bg-amber-400 h-full" style={ { width: `${(r.pending/r.total)*100}%` } }></div>}</div></div>))}</div></div>
                    </div>
                </div>
            );
        };

        // >>> VIEW 3: ATIVIDADES SP MUST (Com Filtros e Colunas Redimensionáveis)
        const DetailedReportView = ({ activities, onImport }) => {
            const [filterOrigin, setFilterOrigin] = useState('Consolidado');
            const [filterResponsible, setFilterResponsible] = useState('Todos');
            const [searchTerm, setSearchTerm] = useState('');
            const fileRef = useRef(null);

            // Larguras iniciais das colunas
            const [colWidths, setColWidths] = useState({
                origem: 120,
                atividade: 300,
                responsavel: 150,
                data: 100,
                dias: 80,
                obs: 200
            });

            // Extrair opções únicas para os filtros
            const uniqueOrigins = useMemo(() => ['Consolidado', ...new Set(activities.map(a => a.sheetName).filter(Boolean))], [activities]);
            const uniqueResponsibles = useMemo(() => ['Todos', ...new Set(activities.map(a => a.responsavel).filter(Boolean))], [activities]);

            // Lógica de Filtragem
            const filteredActivities = useMemo(() => {
                return activities.filter(item => {
                    const matchesOrigin = filterOrigin === 'Consolidado' || item.sheetName === filterOrigin;
                    const matchesResp = filterResponsible === 'Todos' || item.responsavel === filterResponsible;
                    const matchesSearch = searchTerm === '' || 
                                          item.atividade.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                          (item.obs && item.obs.toLowerCase().includes(searchTerm.toLowerCase()));
                    return matchesOrigin && matchesResp && matchesSearch;
                });
            }, [activities, filterOrigin, filterResponsible, searchTerm]);

            const exportDetailed = () => {
                const dataToExport = filteredActivities.map(a => ({
                    ID: a.id, Origem: a.sheetName, Atividade: a.atividade, 
                    Responsável: a.responsavel, Status: a.status, 
                    Previsão: Utils.formatDate(a.dueDate), 
                    'Dias Úteis': Utils.calculateWorkdays(a.dueDate),
                    Obs: a.obs
                }));
                const ws = XLSX.utils.json_to_sheet(dataToExport);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Atividades_Filtradas");
                XLSX.writeFile(wb, `Atividades_SP_MUST.xlsx`);
            };

            return (
                <div className="flex flex-col h-full fade-in">
                    
                    {/* CONTAINER DE FILTROS SUPERIOR */}
                    <div className="flex flex-col gap-4 mb-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex justify-between items-center">
                            <div>
                                <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><Icons.Table className="text-purple-600"/> Atividades SP MUST</h2>
                                <p className="text-xs text-slate-500">Gestão e Filtros do Relatório Importado</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={()=>fileRef.current.click()} className="flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-200 rounded hover:bg-emerald-100 text-xs font-medium transition"><Icons.Upload className="w-3 h-3"/> Importar Excel</button>
                                <input type="file" ref={fileRef} hidden accept=".xlsx, .xls" onChange={onImport} />
                                <button onClick={exportDetailed} className="flex items-center gap-2 px-3 py-1.5 bg-purple-50 text-purple-700 border border-purple-200 rounded hover:bg-purple-100 text-xs font-medium transition"><Icons.Download className="w-3 h-3"/> Exportar</button>
                            </div>
                        </div>
                        
                        {/* Linha de Controles de Filtro */}
                        <div className="flex flex-wrap items-center gap-3 pt-2 border-t border-slate-100 mt-2">
                            
                            {/* Filtro Origem */}
                            <div className="flex flex-col">
                                <label className="text-[10px] font-bold text-slate-400 uppercase mb-1">Visualização (Aba)</label>
                                <select 
                                    className="text-sm border border-slate-300 rounded px-2 py-1.5 bg-white focus:border-blue-500 outline-none min-w-[150px]"
                                    value={filterOrigin}
                                    onChange={(e) => setFilterOrigin(e.target.value)}
                                >
                                    {uniqueOrigins.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                </select>
                            </div>

                            {/* Filtro Responsável */}
                            <div className="flex flex-col">
                                <label className="text-[10px] font-bold text-slate-400 uppercase mb-1">Responsável</label>
                                <select 
                                    className="text-sm border border-slate-300 rounded px-2 py-1.5 bg-white focus:border-blue-500 outline-none min-w-[150px]"
                                    value={filterResponsible}
                                    onChange={(e) => setFilterResponsible(e.target.value)}
                                >
                                    {uniqueResponsibles.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                </select>
                            </div>

                            {/* Busca Texto */}
                            <div className="flex flex-col flex-grow">
                                <label className="text-[10px] font-bold text-slate-400 uppercase mb-1">Busca Rápida</label>
                                <div className="relative">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar atividade ou observação..." 
                                        className="w-full text-sm border border-slate-300 rounded pl-8 pr-2 py-1.5 focus:border-blue-500 outline-none"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <div className="absolute left-2.5 top-2 text-slate-400"><Icons.Search className="w-3.5 h-3.5" /></div>
                                </div>
                            </div>

                            <div className="flex flex-col justify-end">
                                <span className="text-xs font-bold text-slate-500 bg-slate-100 px-3 py-1.5 rounded self-end mb-0.5 mt-auto">
                                    {filteredActivities.length} itens
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border rounded-xl shadow-sm flex-grow overflow-hidden flex flex-col">
                        <div className="overflow-auto h-full custom-scrollbar">
                            <table className="text-sm text-left border-collapse table-fixed" style={ { minWidth: '100%' } }>
                                <thead className="bg-slate-100 text-slate-700 font-bold sticky top-0 z-10 shadow-sm">
                                    <tr>
                                        <ResizableHeader width={colWidths.origem} onResize={(w) => setColWidths({...colWidths, origem: w})}>Origem</ResizableHeader>
                                        <ResizableHeader width={colWidths.atividade} onResize={(w) => setColWidths({...colWidths, atividade: w})}>Atividade</ResizableHeader>
                                        <ResizableHeader width={colWidths.responsavel} onResize={(w) => setColWidths({...colWidths, responsavel: w})}>Responsável</ResizableHeader>
                                        <ResizableHeader width={colWidths.data} onResize={(w) => setColWidths({...colWidths, data: w})}>Data Limite</ResizableHeader>
                                        <ResizableHeader width={colWidths.dias} onResize={(w) => setColWidths({...colWidths, dias: w})}>Dias Úteis</ResizableHeader>
                                        <ResizableHeader width={colWidths.obs} onResize={(w) => setColWidths({...colWidths, obs: w})}>Obs</ResizableHeader>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {filteredActivities.map((row, i) => {
                                        const wd = Utils.calculateWorkdays(row.dueDate);
                                        const wdColor = wd < 0 ? 'text-red-600 font-bold bg-red-50' : wd < 5 ? 'text-amber-600 font-medium' : 'text-emerald-600';
                                        
                                        return (
                                            <tr key={i} className="hover:bg-slate-50 transition-colors group">
                                                <td className="p-3 text-[10px] text-slate-500 uppercase tracking-wide font-bold truncate border-r border-transparent group-hover:border-slate-100">{row.sheetName}</td>
                                                <td className="p-3 font-medium text-slate-700 truncate" title={row.atividade}>{row.atividade}</td>
                                                <td className="p-3 text-slate-600 truncate"><span className="bg-slate-100 px-2 py-0.5 rounded text-xs border">{row.responsavel}</span></td>
                                                <td className="p-3 text-center text-slate-500 text-xs truncate">{Utils.formatDate(row.dueDate)}</td>
                                                <td className="p-3 text-center"><span className={`px-2 py-0.5 rounded ${wdColor}`}>{wd}</span></td>
                                                <td className="p-3 text-xs text-slate-500 italic truncate" title={row.obs}>{row.obs}</td>
                                            </tr>
                                        );
                                    })}
                                    {filteredActivities.length === 0 && (
                                        <tr><td colSpan="6" className="p-10 text-center text-slate-400">Nenhum dado encontrado com os filtros atuais.</td></tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };


        const PlannerView = ({ plannerData, setPlannerData }) => {
            const [newItem, setNewItem] = useState('');
            const addItem = (list, text) => { if(text.trim()) setPlannerData(prev => ({...prev, [list]: [...prev[list], {id: Date.now(), text}]})); };
            const removeItem = (list, id) => { setPlannerData(prev => ({...prev, [list]: prev[list].filter(i => i.id !== id)})); };
            const WeekColumn = ({ title, listKey, items }) => (
                <div className="min-w-[200px] flex-shrink-0 flex flex-col bg-slate-50 rounded-lg border h-full"><div className="p-3 border-b bg-white rounded-t-lg font-bold text-sm text-slate-700">{title} <span className="text-slate-400 text-xs ml-1">{items.length}</span></div><div className="flex-grow p-2 space-y-2 overflow-y-auto custom-scrollbar">{items.map(item => (<div key={item.id} className="bg-white p-3 rounded border shadow-sm text-sm relative group">{item.text}<button onClick={()=>removeItem(listKey, item.id)} className="absolute top-2 right-2 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><Icons.Trash2 width="14"/></button></div>))}</div><div className="p-2 border-t bg-white"><input className="w-full text-xs p-2 border rounded" placeholder="+ Item" onKeyDown={e=>{if(e.key==='Enter'){addItem(listKey, e.target.value); e.target.value='';}}} /></div></div>
            );
            return (
                <div className="h-full flex flex-col fade-in">
                    <h2 className="font-bold text-lg mb-4 text-slate-800 flex items-center gap-2"><Icons.Columns className="text-indigo-600"/> Planner Semanal</h2>
                    <div className="flex-grow overflow-x-auto pb-2 flex gap-3">
                        <WeekColumn title="Backlog" listKey="backlog" items={plannerData.backlog} /><WeekColumn title="Segunda" listKey="mon" items={plannerData.mon} /><WeekColumn title="Terça" listKey="tue" items={plannerData.tue} /><WeekColumn title="Quarta" listKey="wed" items={plannerData.wed} /><WeekColumn title="Quinta" listKey="thu" items={plannerData.thu} /><WeekColumn title="Sexta" listKey="fri" items={plannerData.fri} />
                    </div>
                </div>
            );
        };

        const PLCTableView = ({ tasks, onUpdate, onDelete, onAdd }) => (
            <div className="flex flex-col h-full fade-in">
                <div className="flex justify-between items-center mb-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                    <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><Icons.Layout className="text-blue-600"/> Tarefas PLC</h2>
                    <button onClick={onAdd} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700">Nova Tarefa</button>
                </div>
                <div className="bg-white border rounded-xl shadow-sm flex-grow overflow-hidden flex flex-col">
                    <div className="overflow-auto custom-scrollbar flex-grow">
                        <table className="w-full text-sm text-left border-collapse min-w-[600px]"><thead className="bg-slate-50 text-slate-600 sticky top-0 z-10"><tr><th className="p-3 w-12">#</th><th className="p-3">Tarefa</th><th className="p-3 w-32">Resp.</th><th className="p-3 w-32">Status</th><th className="p-3 w-12"></th></tr></thead><tbody className="divide-y">{tasks.map((task, i) => (<tr key={task.id} className="hover:bg-slate-50"><td className="p-2 text-center text-slate-400">{i+1}</td><td className="p-2"><input className="cell-input font-medium" value={task.title} onChange={e=>onUpdate(task.id,'title',e.target.value)} /></td><td className="p-2"><input className="cell-input" value={task.assignee} onChange={e=>onUpdate(task.id,'assignee',e.target.value)} /></td><td className="p-2"><select className="cell-input" value={task.status} onChange={e=>onUpdate(task.id,'status',e.target.value)}><option value="todo">Pendente</option><option value="done">Concluído</option></select></td><td className="p-2 text-center"><button onClick={()=>onDelete(task.id)} className="text-slate-300 hover:text-red-500"><Icons.Trash2 width="16"/></button></td></tr>))}</tbody></table>
                    </div>
                </div>
            </div>
        );

        // --- NEW VIEWS: Eisenhower & ProsCons ---

        const EisenhowerView = ({ eisenData, setEisenData }) => {
            const [dragItem, setDragItem] = useState(null);
            const onDragStart = (e, item, list) => setDragItem({item, list});
            const onDrop = (e, targetList) => {
                if(!dragItem) return;
                const { item, list } = dragItem;
                if(list !== targetList) {
                    setEisenData(prev => {
                        const newState = {...prev};
                        newState[list] = newState[list].filter(i => i.id !== item.id);
                        newState[targetList] = [...newState[targetList], item];
                        return newState;
                    });
                }
                setDragItem(null);
            };
            const addItem = (list, text) => { if(text.trim()) setEisenData(prev => ({...prev, [list]: [...prev[list], {id: Date.now(), text}]})); };
            const removeItem = (list, id) => { setEisenData(prev => ({...prev, [list]: prev[list].filter(i => i.id !== id)})); };

            const Quadrant = ({ title, listKey, bg, color }) => {
                const [input, setInput] = useState('');
                return (
                    <div className={`p-4 rounded-xl border flex flex-col ${bg} ${color} h-full`} onDragOver={e=>e.preventDefault()} onDrop={e=>onDrop(e, listKey)}>
                        <h3 className="font-bold mb-3 uppercase text-xs tracking-wider opacity-80">{title}</h3>
                        <div className="flex-grow space-y-2 overflow-y-auto custom-scrollbar" style={{minHeight:'100px'}}>
                            {eisenData[listKey].map(item => (
                                <div key={item.id} draggable onDragStart={e=>onDragStart(e, item, listKey)} className="bg-white p-3 rounded shadow-sm text-sm text-slate-800 cursor-grab flex justify-between group hover:shadow-md transition">
                                    <span>{item.text}</span><button onClick={()=>removeItem(listKey, item.id)} className="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><Icons.Trash2 width="14"/></button>
                                </div>
                            ))}
                        </div>
                        <input className="mt-3 w-full text-xs p-2 rounded border-0 shadow-sm focus:ring-2 focus:ring-opacity-50 focus:ring-blue-500 text-slate-800" placeholder="Adicionar..." value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'){addItem(listKey, input); setInput('');}}} />
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col fade-in overflow-hidden">
                    <h2 className="font-bold text-lg mb-4 text-slate-800 flex items-center gap-2"><Icons.Grid className="text-indigo-600"/> Matriz Eisenhower</h2>
                    <div className="flex-grow grid grid-cols-1 md:grid-cols-2 grid-rows-2 gap-4 overflow-y-auto pb-2">
                        <Quadrant title="Urgente & Importante" listKey="urgentImportant" bg="bg-red-50 border-red-200" color="text-red-800" />
                        <Quadrant title="Não Urgente & Importante" listKey="notUrgentImportant" bg="bg-blue-50 border-blue-200" color="text-blue-800" />
                        <Quadrant title="Urgente & Não Importante" listKey="urgentNotImportant" bg="bg-amber-50 border-amber-200" color="text-amber-800" />
                        <Quadrant title="Não Urgente & Não Importante" listKey="notUrgentNotImportant" bg="bg-slate-100 border-slate-200" color="text-slate-700" />
                    </div>
                </div>
            );
        };

        const ProsConsView = ({ pcData, setPcData }) => {
            const addItem = (type, text) => { if(text.trim()) setPcData(prev => ({...prev, [type]: [...prev[type], {id: Date.now(), text}]})); };
            const removeItem = (type, id) => { setPcData(prev => ({...prev, [type]: prev[type].filter(i => i.id !== id)})); };

            const List = ({ type, items, color, bg }) => {
                const [input, setInput] = useState('');
                return (
                    <div className={`flex-1 p-6 rounded-xl border flex flex-col ${bg} ${color}`}>
                        <h3 className="font-bold text-lg mb-4 flex items-center gap-2">{type==='pros'?<Icons.ThumbsUp/>:<Icons.ThumbsUp className="rotate-180"/>} {type==='pros'?'Prós / Vantagens':'Contras / Desvantagens'}</h3>
                        <ul className="flex-grow space-y-3 overflow-y-auto custom-scrollbar">
                            {items.map(item => (
                                <li key={item.id} className="flex items-center group bg-white/60 p-3 rounded-lg shadow-sm">
                                    <div className={`w-2 h-2 rounded-full mr-3 ${type==='pros'?'bg-emerald-400':'bg-rose-400'}`}></div>
                                    <span className="flex-grow text-slate-700 font-medium">{item.text}</span>
                                    <button onClick={()=>removeItem(type, item.id)} className="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><Icons.Trash2 width="14"/></button>
                                </li>
                            ))}
                        </ul>
                        <div className="mt-4 bg-white rounded-lg p-1 shadow-sm border border-slate-200 flex">
                            <input className="flex-grow p-2 text-sm outline-none bg-transparent text-slate-700" placeholder="Adicionar argumento..." value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'){addItem(type, input); setInput('');}}} />
                            <button onClick={()=>{addItem(type, input); setInput('');}} className="px-3 py-1 rounded bg-slate-100 hover:bg-slate-200 text-slate-600"><Icons.Plus width="16"/></button>
                        </div>
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col fade-in">
                    <h2 className="font-bold text-lg mb-4 text-slate-800 flex items-center gap-2"><Icons.ThumbsUp className="text-indigo-600"/> Análise de Decisão</h2>
                    <div className="flex-grow flex flex-col md:flex-row gap-6 overflow-y-auto pb-2">
                        <List type="pros" items={pcData.pros} bg="bg-emerald-50 border-emerald-100" color="text-emerald-800" />
                        <List type="cons" items={pcData.cons} bg="bg-rose-50 border-rose-100" color="text-rose-800" />
                    </div>
                </div>
            );
        };

        // --- APP MAIN ---
        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(window.innerWidth > 768);
            
            // Estado de Dados
            const [data, setData] = useState(() => {
                const s = localStorage.getItem('project_db_mobile_v1');
                if(s) { try { const p = JSON.parse(s); if(p.detailedActivities) p.detailedActivities.forEach(a=>a.dueDate=Utils.parseDate(a.dueDate)); return p; } catch(e){} }
                return { simpleTasks: [], detailedActivities: [], planner: {backlog:[], mon:[], tue:[], wed:[], thu:[], fri:[]}, eisenhower: {urgentImportant:[], notUrgentImportant:[], urgentNotImportant:[], notUrgentNotImportant:[]}, prosCons: {pros:[], cons:[]} };
            });
            useEffect(() => localStorage.setItem('project_db_mobile_v1', JSON.stringify(data)), [data]);

            const handleImportDetailed = (e) => {
                const file = e.target.files[0]; if(!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, {type:'binary'});
                    let all = [];
                    wb.SheetNames.forEach(sheet => {
                        const json = XLSX.utils.sheet_to_json(wb.Sheets[sheet]);
                        all = [...all, ...json.map((r,i) => ({ id: `${sheet}-${i}`, sheetName: sheet, atividade: r['ATIVIDADES']||r['Atividade']||'', responsavel: r['RESPONSÁVEL']||r['Responsável']||'', status: sheet.includes('CONCLUÍDO')?'Concluído':'Pendente', dueDate: Utils.parseDate(r['DATA LIMITE']||r['Data']), obs: r['OBSERVAÇÃO']||'' }))];
                    });
                    setData(p => ({...p, detailedActivities: all}));
                };
                reader.readAsBinaryString(file);
            };

            return (
                <div className="flex h-screen bg-slate-50 overflow-hidden relative">
                    {/* MOBILE OVERLAY */}
                    {sidebarOpen && window.innerWidth < 768 && <div className="fixed inset-0 bg-black/50 z-20" onClick={()=>setSidebarOpen(false)}></div>}
                    
                    {/* SIDEBAR */}
                    <aside className={`fixed md:relative z-30 h-full bg-slate-900 text-white flex flex-col shadow-xl sidebar-transition ${sidebarOpen ? 'w-64 translate-x-0' : '-translate-x-full md:translate-x-0 md:w-20'}`}>
                        <div className="h-16 flex items-center justify-between px-6 border-b border-slate-800 bg-slate-900 shrink-0">
                            <div className="flex items-center gap-3"><div className="bg-blue-600 p-1.5 rounded"><Icons.Layout className="text-white"/></div>{sidebarOpen && <span className="font-bold text-lg">ProjectHub</span>}</div>
                            {sidebarOpen && window.innerWidth < 768 && <button onClick={()=>setSidebarOpen(false)}><Icons.Close className="w-5 h-5 text-slate-400"/></button>}
                        </div>
                        <nav className="flex-grow py-4 px-2 space-y-1 overflow-y-auto custom-scrollbar">
                            {[ 
                                {id:'dashboard', icon:<Icons.BarChart/>, label:'Dashboard'}, 
                                {id:'plc', icon:<Icons.Layout/>, label:'Tarefas PLC'}, 
                                {id:'detailed', icon:<Icons.Table/>, label:'Atividades SP Must'}, 
                                {id:'planner', icon:<Icons.Columns/>, label:'Planner'},
                                {id:'eisenhower', icon:<Icons.Grid/>, label:'Matriz Eisenhower'},
                                {id:'proscons', icon:<Icons.ThumbsUp/>, label:'Prós/Contras'}
                            ].map(item => (
                                <button key={item.id} onClick={()=>{setCurrentView(item.id); if(window.innerWidth<768) setSidebarOpen(false);}} className={`w-full flex items-center p-3 rounded-lg transition-all ${currentView===item.id ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`} title={!sidebarOpen ? item.label : ''}>
                                    <span className="shrink-0">{item.icon}</span><span className={`ml-3 font-medium text-sm transition-opacity duration-300 ${sidebarOpen ? 'opacity-100' : 'opacity-0 md:hidden'}`}>{item.label}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-slate-800 flex justify-center bg-slate-900 hidden md:flex">
                            <button onClick={()=>setSidebarOpen(!sidebarOpen)} className="p-2 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition shadow-sm border border-slate-700"><Icons.Menu/></button>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-grow flex flex-col h-full overflow-hidden relative w-full">
                        <header className="h-16 bg-white border-b flex items-center justify-between px-4 md:px-8 shadow-sm shrink-0 z-10">
                            <div className="flex items-center gap-3">
                                <button onClick={()=>setSidebarOpen(true)} className="md:hidden p-2 -ml-2 text-slate-600"><Icons.Menu className="w-6 h-6"/></button>
                                <h1 className="text-lg md:text-xl font-bold text-slate-800 truncate">
                                    {currentView==='dashboard'?'Visão Geral':currentView==='plc'?'Tarefas PLC':currentView==='detailed'?'Relatório Must':currentView==='planner'?'Planner':currentView==='eisenhower'?'Matriz Eisenhower':'Prós e Contras'}
                                </h1>
                            </div>
                            <div className="text-xs text-slate-500 font-medium bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200 hidden sm:block">{Utils.getTodayString()}</div>
                        </header>
                        <div className="flex-grow p-3 md:p-6 overflow-auto bg-slate-50/50 relative">
                            {currentView==='dashboard' && <DashboardView detailedActivities={data.detailedActivities} />}
                            {currentView==='plc' && <PLCTableView tasks={data.simpleTasks} onUpdate={(id,f,v)=>setData(p=>({...p,simpleTasks:p.simpleTasks.map(t=>t.id===id?{...t,[f]:v}:t)}))} onDelete={id=>setData(p=>({...p,simpleTasks:p.simpleTasks.filter(t=>t.id!==id)}))} onAdd={()=>setData(p=>({...p,simpleTasks:[...p.simpleTasks,{id:Date.now(),title:'',status:'todo'}]}))} />}
                            {currentView==='detailed' && <DetailedReportView activities={data.detailedActivities} onImport={handleImportDetailed} />}
                            {currentView==='planner' && <PlannerView plannerData={data.planner} setPlannerData={fn=>setData(p=>({...p,planner:fn(p.planner)}))} />}
                            {currentView==='eisenhower' && <EisenhowerView eisenData={data.eisenhower} setEisenData={fn=>setData(p=>({...p,eisenhower:fn(p.eisenhower)}))} />}
                            {currentView==='proscons' && <ProsConsView pcData={data.prosCons} setPcData={fn=>setData(p=>({...p,prosCons:fn(p.prosCons)}))} />}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>